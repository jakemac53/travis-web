<div class='billing-checkout' data-test-payment-form='true'>
  <Billing::SelectedPlan 
    @selectedPlan={{this.selectedPlan}} 
    @showAnnual={{this.showAnnual}} 
    @goToFirstStep={{action this.goToFirstStep}}
    @discountedPrice={{discountedPrice}}
  />
  <div class='flex flex--wrap billing-checkout__details' data-test-contact-details='true'>
    <div class='flex--col-3'>
      <h4 data-test-contact-heading='true'>contact details</h4>
      <p data-test-contact-firstName='true' class='billing-checkout__details--info'>{{concat this.firstName ' ' this.lastName}}</p>
      <p data-test-contact-company='true' class='billing-checkout__details--info'>{{this.company}}</p>
      <div>
       <p data-test-contact-email='true' class='billing-checkout__details--email'>{{this.email}}</p>
      </div>
      <button data-test-edit-contact-button='true' class='mt-3 button--white button--hover' onClick={{action back 'contactDetails'}}>Edit contact details</button>
    </div>
    <div class='flex--col-3'>
      <h4 data-test-billing-heading='true'>billing details</h4>
      <p data-test-billing-address='true' class='billing-checkout__details--info'>{{this.address}}</p>
      <p data-test-billing-city='true' class='billing-checkout__details--info'>{{this.city}}</p>
      <p data-test-billing-country='true' class='billing-checkout__details--info'>{{this.country}}</p>
      <button data-test-edit-billing-button='true' class='mt-3 button--white button--hover' onClick={{action back 'billingDetails'}}>Edit billing details</button>
    </div>
    <div class='flex--col-3'>
      <h4>discount</h4>
      <p data-test-billing-coupon='true' class='billing-checkout__details--info'>{{this.coupon}}</p>
    </div>
  </div>
  <h3>
    Payment
  </h3>
  <h4 data-test-coupon-code='true' class="pb-3">coupon code</h4>
  <div class="pb-3">
    <TravisForm data-test-coupon-form='true' @onSubmit={{perform this.validateCoupon}} as |form|>
      <div class="coupon-validation flex flex--center flex-v-center">
        <form.field
          class="coupon-validation__input"
          @value={{this.coupon}}
          @showValidationStatusIcons={{false}}
          @onChange={{action (mut this.coupon)}} 
          as |Field|
        >
          <Field.input @name='coupon' @placeholder='Coupon code'/>
        </form.field>
        <div class="coupon-validation__validate-button">
          {{#if this.validateCoupon.isRunning}}
            <LoadingIndicator/>
          {{else if this.isValidCoupon}}
            <p class="coupon-validation__valid-coupon">
              <SvgImage @name="icon-passed" @class="icon icon-passed" />
              Coupon applied
            </p>
          {{else if (and this.couponResult this.isInvalidCoupon)}}
            <p class="coupon-validation__invalid-coupon">
              <SvgImage @name="warn" @class="icon icon-warn" />
              Coupon invalid
            </p>
          {{else}}
            <button class='button--white' {{action form.submit}} data-test-coupon='true'>
              Validate coupon
            </button>
          {{/if}}
        </div>
      </div>
    </TravisForm>
  </div>
  <span class="notice-banner--white" data-test-help-text='true'>
    <SvgImage @name='icon-help' @class='icon-help' />
    Credit card details are never stored on nor reach our servers. Payment data is handled by Stripe.
  </span>
  <h4 data-test-credit-card='true' class="py-3">credit card details</h4>
  <TravisForm data-test-stripe-form='true' @onSubmit={{perform this.createSubscription}} as |form|>
    <StripeCard @complete={{action "complete"}} @options={{this.options}} as |stripeError|>
      {{#if stripeError}}
        <p>{{stripeError.message}}</p>
      {{/if}}
    </StripeCard>
    <div class='billing-checkout__payment'>
      {{#if this.isLoading}}
        <LoadingIndicator/>
      {{else}}
        <button class='{{if this.stripeElement 'button--green' 'button disabled'}}' {{action form.submit}} data-test-complete-payment='true'>
          Pay {{this.discountedPrice}} to complete subscription
        </button>
      {{/if}}
    </div>
  </TravisForm>
</div>
